{% extends 'common/base_menu.html' %}
{% block css%}
<link rel="stylesheet" href="/static/assets/checkbox/skins/all.css">
 <link href="/static/Avgrund/css/avgrund.css" rel="stylesheet" type="text/css">
 <link href="/static/assets/global/css/bootstrap-select.css" rel="stylesheet" type="text/css">
{% endblock %}

<style type="text/css">
    .botCenter{width:100%; height:35px; line-height:35px; position:fixed; bottom:0; left:0; font-size:14px;  text-align:center;}
        body {
        font-size: 14px;
        font-family: "Arial", "microsoft yahei";
    }

    table {
    	border-collapse: collapse;
        margin: 0 auto;
        min-width: 700px;
    }

    td,
    th {
        border: 1px solid #dcdcdc;
        text-align: center;
        height: 30px;
    }

    thead tr {
        font-weight: bold;
        background-color: #f4f4f4;
        vertical-align: middle;
    }
    a{
        height:32px;
        width:150px;
{#        float: left;#}
        top: 20%;
        position: relative;
        left: 25%;
    }
    #div1{

      position: relative;
      text-align: center;
    }
    .focus {
        font: normal 14px NSimSun ;
        color: red;
        font-weight: bold;
    }
    </style>
{% block content %}
           <div class="page-sidebar-wrapper">
        <div class="page-sidebar navbar-collapse collapse">
        <ul class="page-sidebar-menu page-header-fixed" data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200">
            <li class="sidebar-toggler-wrapper hide">
                <!-- BEGIN SIDEBAR TOGGLER BUTTON -->
                <div class="sidebar-toggler"></div>
                <!-- END SIDEBAR TOGGLER BUTTON -->
            </li>
             <li class="nav-item active open">
                <a href="javascript:;" class="nav-link nav-toggle">
                    <i class="icon-home"></i>
                    <span class="title">个人中心</span>
                    <span class="arrow open"></span>
                </a>
                <ul class="sub-menu ">
                    <li class="nav-item  ">
                        <a href="/overall/index" class="nav-link ">
                            <i class="icon-user"></i>
                            <span class="title">个人信息</span>

                        </a>
                    </li>
                    <li class="nav-item  ">
                        <a href="/overall/refer" class="nav-link ">
                            <i class="icon-list"></i>
                            <span class="title">我的申请</span>
                            <span class="badge badge-success" id="refercounts"></span>

                        </a>
                    </li>
                    <li class="nav-item  ">
                        <a href="/overall/approve" class="nav-link ">
                            <i class="icon-pencil"></i>
                            <span class="title">我的审批</span>
                        </a>
                    </li>
                    <li class="nav-item  "id="seniormanagement" style="display: none">
                        <a href="javascript:;" class="nav-link ">
                            <i class="icon-star"></i>
                            <span class="title">高级管理</span>
                            <span class="arrow open"></span>
                        </a>
                        <ul class="sub-menu">
                            <li class="nav-item " id="mailgroupmanager" style="display: none">
                                <a class="nav-link " href="/overall/managershowmailgroup">
                                    <i class="icon-envelope-open"></i>
                                    <span class="title">邮箱群组管理</span>
                                </a>
                            </li>
                            <li class="nav-item "id="publicmailmanager" style="display: none">
                                <a class="nav-link " href="/overall/managershowpublicmail">
                                    <i class="icon-envelope-letter"></i>
                                    <span class="title">公共邮箱管理</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li class="nav-item active open" id="showdirctormenu" style="display: none">
                <a href="javascript:;" class="nav-link nav-toggle">
                    <i class="icon-pointer"></i>
                    <span class="title">审批管理</span>
                    <span class="arrow open"></span>
                </a>
                <ul class="sub-menu" >
                     <li class="nav-item  "   id="mailpermissionid"  style="display: none" >
                        <a href="/overall/directorapproval" class="nav-link ">
                            <span class="title">邮箱群组权限审批</span>
                            <span class="badge badge-success" id="dirctorcounts"></span>
                        </a>
                    </li>
                    <li class="nav-item  "   id="Licensingsoftware"  style="display: none" >
                        <a href="/overall/softwareapprovals" class="nav-link ">
                            <span class="title">授权软件审批</span>
                            <span class="badge badge-success" id="softaccounts"></span>
                        </a>
                    </li>
                    <li class="nav-item  "   id="publicpermissionid"  style="display: none" >
                        <a href="/overall/publicapproval" class="nav-link ">
                            <span class="title">新建公共邮箱审批</span>
                            <span class="badge badge-success" id="publiccounts"></span>
                        </a>
                    </li>
                    <li class="nav-item  "   id="mailgrouppermissionid"  style="display: none" >
                        <a href="/overall/mailgroupapproval" class="nav-link ">
                            <span class="title">新建邮箱群组审批</span>
                            <span class="badge badge-success" id="mailgroupcounts"></span>
                        </a>
                    </li>
                    <li class="nav-item  "   id="internetpermissionid"  style="display: none" >
                        <a href="/overall/internetdirectorapproval" class="nav-link ">
                            <span class="title">上网权限审批</span>
                            <span class="badge badge-success" id="internetcounts"></span>
                        </a>
                    </li>
                    <li class="nav-item  "   id="wrielesspermissionid"  style="display: none" >
                        <a href="/overall/wirelessdirectorapproval" class="nav-link ">
                            <span class="title">无线上网权限审批</span>
                            <span class="badge badge-success" id="wirelesscounts"></span>
                        </a>
                    </li>
                    <li class="nav-item  "   id="vpnpermissionid"  style="display: none" >
                        <a href="/overall/vpndirectorapproval" class="nav-link ">
                            <span class="title">VPN权限审批</span>
                            <span class="badge badge-success" id="vpncounts"></span>
                        </a>
                    </li>
                    <li class="nav-item" id="zwpermissionid" style="display: none" >
                        <a href="/overall/zwapproval" class="nav-link ">
                            <span class="title">VPN权限审批</span>
                            <span class="badge badge-success" id="zwcounts"></span>
                        </a>
                    </li>
                   <li class="nav-item  "   id="dnatpermissionid"  style="display: none" >
                        <a href="/overall/dnatdirectorapproval" class="nav-link ">
                            <span class="title">端口映射权限审批</span>
                            <span class="badge badge-success" id="dnatcounts"></span>
                        </a>
                    </li>
                     <li class="nav-item  "   id="safepermissionid"  style="display: none" >
                        <a href="/overall/safedirectorapproval" class="nav-link ">
                            <span class="title">端口映射权限审批</span>
                            <span class="badge badge-success" id="safecounts"></span>
                        </a>
                    </li>
                    <li class="nav-item  "   id="idcpermissionid"  style="display: none" >
                        <a href="/overall/idcdirectorapproval" class="nav-link ">
                            <span class="title">端口映射权限审批</span>
                            <span class="badge badge-success" id="idccounts"></span>
                        </a>
                    </li>
                </ul>
            </li>
            <li class="nav-item active open">
                <a href="javascript:;" class="nav-link nav-toggle">
                    <i class="icon-social-dribbble"></i>
                    <span class="title">网络权限</span>
                    <span class="arrow open"></span>
                </a>
                <ul class="sub-menu">
                    <li class="nav-item  ">
                        <a href="/net/internetapply/" class="nav-link ">
                            <span class="title">上网权限</span>
                            <span class="selected"></span>
                        </a>
                    </li>
                    <li class="nav-item  ">
                        <a href="/net/wirelessapply/" class="nav-link ">
                            <span class="title">无线权限</span>
                        </a>
                    </li>
                    <li class="nav-item  ">
                        <a href="/net/vpnapply/" class="nav-link ">
                            <span class="title">VPN权限</span>
                        </a>
                    </li>
                    <li class="nav-item  ">
                        <a href="/net/speedupapply/" class="nav-link ">
                            <span class="title">提速权限</span>
                        </a>
                    </li>
                    <li class="nav-item   ">
                        <a href="/net/add_Node/" class="nav-link ">
                            <span class="title">PF用户白名单</span>

                        </a>
                    </li>
                     <li class="nav-item active  ">
                        <a href="/net/node_Delete/" class="nav-link ">
                            <span class="title">PF用户查询与删除</span>
                        </a>
                    </li>
                </ul>
            </li>
            <li class="nav-item  active open ">
                <a href="javascript:;" class="nav-link nav-toggle">
                    <i class="icon-envelope"></i>
                    <span class="title">邮箱权限</span>
                    <span class="arrow open"></span>
                </a>
                <ul class="sub-menu">
                    <li class="nav-item ">
                        <a href="/mail/unclockmail" class="nav-link ">
                            <span class="title">手机邮箱解除阻止</span>
                        </a>
                    </li>
                    <li class="nav-item  ">
                        <a href="/mail/mailgroupapply" class="nav-link ">
                            <span class="title">邮箱群组权限申请</span>

                        </a>
                    </li>
                    <li class="nav-item  ">
                        <a href="/mail/createpublicmail" class="nav-link ">
                            <span class="title">新建公共邮箱</span>
                        </a>
                    </li>
                    <li class="nav-item  ">
                        <a href="/mail/createmailgroup" class="nav-link ">
                            <span class="title">新建邮箱群组</span>

                        </a>
                    </li>
                    <li class="nav-item  ">
                        <a href="/mail/findallmail" class="nav-link ">
                            <span class="title">邮箱搜索</span>
                        </a>
                    </li>
                </ul>
            </li>

        </ul>
    </div>
    </div>
            <div class="page-content-wrapper">
                 <div class="page-content" style="min-height: 1036px">
                    <div class="page-head">
                        <div class="page-title">
                            <h1>PF用户查询、注销、删除
                                <small>--Node查询、注销、删除</small>
                            </h1>
                        </div>
                    </div>
                 <div class="row">
                    <div class="col-md-12">
                        <div class="portlet light bordered">
                            <div class="portlet-title">
                                <div class="caption">
                                    <i class="icon-layers font-blue-sharp"></i>
                                    <span class="caption-subject font-blue-sharp bold uppercase">用户查询及修改</span>
                                </div>
                            </div>
                            <div class="portlet light bordered">
                                <div class="wrapper wrapper-content animated fadeInRight">
                                    <div class="row" >
                                        <div class="col-sm-12">
                                            <div class="ibox float-e-margins" >
                                                <div class="ibox-content">
                                                    <ul class="nav nav-tabs">
                                                        <li role="presentation" class="active">
                                                            <a href="#tab_mac" data-toggle="tab" aria-expanded="true" style="font-weight: 600"> 以MAC查找 </a>
                                                        </li>
                                                        <li role="presentation" class="">
                                                            <a href="#tab_ad" data-toggle="tab" aria-expanded="false" style="font-weight: 600"> 以AD账号查找 </a>
                                                        </li>
                                                        <li role="presentation" class="">
                                                            <a href="#tab_ip" data-toggle="tab" aria-expanded="false" style="font-weight: 600"> 以IP地址查找 </a>
                                                        </li>
                                                    </ul>
                                                    <div class="tab-content">
                                                        <div class="tab-pane active" id="tab_mac" >
                                                            <div class="portlet-body form" id="speedapply" >
                                                                <form class="form-horizontal" role="form" id="ac_bypass_form">
                                                                    <div class="portlet-body ">
                                                                        <div class="form-group">
                                                                            <label class="control-label col-md-3" >请选择查询条件：</label>
                                                                            <div class="col-md-4">
                                                                                <select class="form-control" id="mac_style">
                                                                                    <option value="0">请选择</option>
                                                                                    <option value="mac_is">Mac地址查找</option>
{#                                                                                    <option value="mac_start">Mac地址前四位模糊查找</option>#}
                                                                                    <option value="mac_end">Mac地址后四位模糊查找</option>
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label class="control-label col-md-3" >请输入设备MAC地址：</label>
                                                                            <div class="col-md-4">
                                                                                <input id="mac_add" name="mac_add" type="text" class="form-control " placeholder="请输入MAC地址">
                                                                                <strong><span class="help-inline" style="font-size: small;color: #00A8FF;">MAC地址格式：1c:39:47:bc:57:7c</span></strong>
                                                                                <button type="button" class="btn btn-s green" data-loading-text="提交中" style="height: 40px;width: 100%;" onclick="node_search()">查询</button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                            <div class="portlet-body" id="mactable" style="white-space: nowrap;overflow: auto;display: none;" >
                                                                    <table class="table  table-bordered table-hover order-column" id="temptable">
                                                                       <thead>
                                                                       <tr >
                                                                           <th>Mac地址</th>
                                                                           <th>状态</th>
                                                                           <th>Pid</th>
                                                                           <th>角色</th>
                                                                           <th>ip</th>
                                                                           <th>有效期</th>
                                                                           <th>计算机名</th>
                                                                           <th>设备类型</th>
                                                                           <th>注册&注销</th>
                                                                           <th>删除</th>
                                                                       </tr>
                                                                       </thead>
                                                                       <tbody>
                                                                       <tr style="display: none">
                                                                           <td id="mac"></td>
                                                                           <td id="status"></td>
                                                                           <td id="pid"></td>
                                                                           <td id="category_id"></td>
                                                                           <td id="ip_add"></td>
                                                                           <td id="unregdate"></td>
                                                                           <td id="computername"></td>
                                                                           <td id="device_class"></td>
                                                                           <td id="delete"></td>
                                                                       </tr>
                                                                       </tbody>
                                                                    </table>
                                                                </div>
                                                        </div>
                                                        <div class="tab-pane" id="tab_ad">
                                                            <div class="ibox-content">
                                                                    <div class="portlet-body form" id="speedapply" >
                                                                        <form class="form-horizontal" role="form" id="ac_bypass_form">
                                                                            <div class="portlet-body ">
                                                                                <div class="form-group">
                                                                                    <label class="control-label col-md-3">请选择查询条件：</label>
                                                                                    <div class="col-md-4">
                                                                                         <select class="form-control" id="pid_style">
                                                                                            <option value="0">请选择</option>
                                                                                            <option value="pid_is">AD账号查找</option>
                                                                                            <option value="pid_start">姓名首字母模糊查找</option>
                                                                                            <option value="pid_end">工号模糊查找</option>
                                                                                         </select>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group">
                                                                                    <label class="control-label col-md-3" >请输入用户PID：</label>
                                                                                    <div class="col-md-4">
                                                                                        <input id="node_pid" name="node_pid" type="text" class="form-control " placeholder="请输入AD工号">
                                                                                        <strong><span class="help-inline" style="font-size: small;color: #00A8FF;">AD格式：hxh25815</span></strong>
                                                                                        <button type="button" class="btn btn-s green" data-loading-text="提交中" style="height: 40px;width: 100%;" onclick="node_search_pid()">查询</button>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </form>
                                                                        <div class="portlet-body" id="adtable" style="white-space: nowrap;overflow: auto;display: none;" >
                                                                            <table class="table  table-bordered table-hover order-column" id="temptable_pid">
                                                                           <thead>
                                                                           <tr >
                                                                               <th>Mac地址</th>
                                                                               <th>状态</th>
                                                                               <th>Pid</th>
                                                                               <th>角色</th>
                                                                               <th>ip</th>
                                                                               <th>有效期</th>
                                                                               <th>计算机名</th>
                                                                               <th>设备类型</th>
                                                                               <th>注册&注销</th>
                                                                               <th>删除</th>
                                                                           </tr>
                                                                           </thead>
                                                                           <tbody>
                                                                           <tr style="display: none">
                                                                               <td id="mac"></td>
                                                                               <td id="status"></td>
                                                                               <td id="pid"></td>
                                                                               <td id="category_id"></td>
                                                                               <td id="ip_add"></td>
                                                                               <td id="unregdate"></td>
                                                                               <td id="computername"></td>
                                                                               <td id="device_class"></td>
                                                                               <td id="delete"></td>
                                                                           </tr>
                                                                           </tbody>
                                                                        </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                        </div>
                                                        <div class="tab-pane" id="tab_ip">
                                                            <div class="ibox-content">
                                                                    <div class="portlet-body form" id="speedapply" >
                                                                        <form class="form-horizontal" role="form" id="ac_bypass_form">
                                                                            <div class="portlet-body ">
                                                                                <div class="form-group">
                                                                                    <label class="control-label col-md-3">请选择查询条件：</label>
                                                                                    <div class="col-md-4">
                                                                                         <select class="form-control" id="ip_style">
                                                                                            <option value="pid_is">ip地址查找</option>
                                                                                         </select>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group">
                                                                                    <label class="control-label col-md-3" >请输入用户IP地址：</label>
                                                                                    <div class="col-md-4">
                                                                                        <input id="node_ip" name="node_pid" type="text" class="form-control " placeholder="请输入ip地址">
                                                                                        <strong><span class="help-inline" style="font-size: small;color: #00A8FF;">ip格式：x.x.x.x</span></strong>
                                                                                        <button type="button" class="btn btn-s green" data-loading-text="提交中" style="height: 40px;width: 100%;" onclick="node_search_ip()">查询</button>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </form>
                                                                        <div class="portlet-body" id="iptable" style="white-space: nowrap;overflow: auto;display: none;" >
                                                                            <table class="table  table-bordered table-hover order-column" id="temptable_ip">
                                                                           <thead>
                                                                           <tr >
                                                                               <th>Mac地址</th>
                                                                               <th>状态</th>
                                                                               <th>Pid</th>
                                                                               <th>角色</th>
                                                                               <th>ip</th>
                                                                               <th>有效期</th>
                                                                               <th>计算机名</th>
                                                                               <th>设备类型</th>
                                                                               <th>注册&注销</th>
                                                                               <th>删除</th>
                                                                           </tr>
                                                                           </thead>
                                                                           <tbody>
                                                                           <tr style="display: none">
                                                                               <td id="mac"></td>
                                                                               <td id="status"></td>
                                                                               <td id="pid"></td>
                                                                               <td id="category_id"></td>
                                                                               <td id="ip_add"></td>
                                                                               <td id="unregdate"></td>
                                                                               <td id="computername"></td>
                                                                               <td id="device_class"></td>
                                                                               <td id="delete"></td>
                                                                           </tr>
                                                                           </tbody>
                                                                        </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                        </div>

                                                    </div>
                                                </div>
                                             </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


{% endblock %}


{% block js %}
<script src="/static/assets/dataTables/jquery.dataTables.js"></script>
<script src="/static/Avgrund/js/avgrund.js"></script>
<script src="/static/assets/chosen/chosen.jquery.js"></script>
<script src="/static/assets/global/scripts/bootstrap-select.js"></script>
<script src="/static/assets/jquery-validation/js/jquery.validate.js"></script>
<script src="/static/assets/checkbox/icheck.min.js"></script>
<script>
    //启动icheck
    $(("[type='radio']")).iCheck({
      checkboxClass: 'icheckbox_minimal-blue',
      radioClass: 'iradio_square-blue'
    });
    var adtableLen = $("#temptable_pid").find("tr").length;
    var mactableLen = $("#temptable").find("tr").length;
    var iptableLen = $("#temptable_ip").find("tr").length;
    function node_search(){
        var mac_add =  $('#mac_add').val();
        var mac_style = $("#mac_style option:checked").val();
        if (mac_add == '' || mac_style == 0){
            alert('请选择完整信息！' )
        }
        else {
            $.ajax({
                url:{% url "node_search" %},
                type:'POST',
                dataType:'json',
                data:{'mac_add':mac_add,'mac_style':mac_style},
                  success:function(data) {
                      $("#temptable tr:gt(0)").remove();
                      var tbody = "";
                      if(data!=""){
                        for(var i=0;i<data.length;i++){
                            var trs="";
                            var mac = data[i][0];
                            var status = data[i][1];
                            var pid = data[i][2];
                            var category_id = data[i][3];
                            var ip = data[i][4];
                            var unregdate = data[i][5];
                            var computername = data[i][6];
                            var device_class = data[i][7];
                            if (status == 'unreg'){
                               trs = "<tr style='background: white'><td>" + mac + "</td><td>" + '未注册' + "</td><td>" + pid + "</td><td>" + category_id + "</td><td>" + ip + "</td><td>" + unregdate + "</td><td>" + computername + "</td><td>" + device_class + "</td><td><button class='btn green btn-outline' onclick='node_logon(\""+mac+"\",\""+pid+"\")'>注册</button></td><td><button class='btn green btn-outline' onclick='node_delete(this,\""+mac+"\")'>删除</button></td></tr>";
                            }
                            else if (status == 'reg'){
                               trs = "<tr style='background: white'><td>" + mac + "</td><td>" + '已注册' + "</td><td>" + pid + "</td><td>" + category_id + "</td><td>" + ip + "</td><td>" + unregdate + "</td><td>" + computername + "</td><td>" + device_class + "</td><td><button class='btn red btn-outline' onclick='node_logoff(this,\""+mac+"\")'>注销</button></td><td><button class='btn green btn-outline' onclick='node_delete(this,\""+mac+"\")'>删除</button></td></tr>";
                            }
                            tbody+=trs;
                        }
                        $("#temptable").append(tbody);
                         if(mactableLen > 1){
                             $("#mactable").show();
                         }
                         else{
                              $("#mactable").hide();
                         }
                        }
                        else {
                            alert('查无此MAC地址！')
                      }
                    }
                });
        }
}


    function node_search_pid(){
        var node_pid =  $('#node_pid').val();
        var pid_style = $("#pid_style option:checked").val();
        if (node_pid == '' || pid_style == 0){
            alert('请选择完整信息！' )
        }
        else {
            $.ajax({
                url:{% url "node_search_pid" %},
                type:'POST',
                dataType:'json',
                data:{'node_pid':node_pid,'pid_style':pid_style},
                  success:function(data) {
                    console.info(data)
                      $("#temptable_pid tr:gt(0)").remove();
                      var tbody = "";
                      if(data!=""){
                        for(var i=0;i<data.length;i++){
                            var trs="";
                            var mac = data[i][0];
                            var status = data[i][1];
                            var pid = data[i][2];
                            var category_id = data[i][3];
                            var ip = data[i][4];
                            var unregdate = data[i][5];
                            var computername = data[i][6];
                            var device_class = data[i][7];
                            if (status == 'unreg'){
                               trs = "<tr style='background: white'><td>" + mac + "</td><td>" + '未注册' + "</td><td>" + pid + "</td><td>" + category_id + "</td><td>" + ip + "</td><td>" + unregdate + "</td><td>" + computername + "</td><td>" + device_class + "</td><td><button class='btn green btn-outline' onclick='node_logon(\""+mac+"\",\""+pid+"\")'>注册</button></td><td><button class='btn green btn-outline' onclick='node_delete(this,\""+mac+"\")'>删除</button></td></tr>";
                            }
                            else if (status == 'reg'){
                               trs = "<tr style='background: white'><td>" + mac + "</td><td>" + '已注册' + "</td><td>" + pid + "</td><td>" + category_id + "</td><td>" + ip + "</td><td>" + unregdate + "</td><td>" + computername + "</td><td>" + device_class + "</td><td><button class='btn red btn-outline' onclick='node_logoff(this,\""+mac+"\")'>注销</button></td><td><button class='btn green btn-outline' onclick='node_delete(this,\""+mac+"\")'>删除</button></td></tr>";
                            }
                            tbody+=trs;
                        }
                        $("#temptable_pid").append(tbody);
                        if(adtableLen > 1){
                                 $("#adtable").show();
                             }
                             else{
                              $("#adtable").hide();
                          }
                        }
                        else {
                            alert('查无此PID！')
                      }
                    }
                });
        }
    }
    function node_search_ip(){
        var node_ip =  $('#node_ip').val();
        if (node_ip == ''){
            alert('请选择完整信息！' )
        }
        else {
            $.ajax({
                url:{% url "node_search_ipaddr" %},
                type:'POST',
                dataType:'json',
                data:{'ip':node_ip},
                  success:function(data) {
                      $("#temptable_ip tr:gt(0)").remove();
                      var tbody = "";
                      if(data["success"] == true){
                        var trs="";
                        var mac = data["mac"];
                        var status = data["status"];
                        var pid = data["pid"];
                        var category_id = data["category_id"];
                        var ip = node_ip;
                        var unregdate = data["unregdate"];
                        var computername = data["computername"];
                        var device_class = data["device_class"];
                        if (status == 'unreg'){
                           trs = "<tr style='background: white'><td>" + mac + "</td><td>" + '未注册' + "</td><td>" + pid + "</td><td>" + category_id + "</td><td>" + ip + "</td><td>" + unregdate + "</td><td>" + computername + "</td><td>" + device_class + "</td><td><button class='btn green btn-outline' onclick='node_logon(\""+mac+"\",\""+pid+"\")'>注册</button></td><td><button class='btn green btn-outline' onclick='node_delete(this,\""+mac+"\")'>删除</button></td></tr>";
                        }
                        else if (status == 'reg'){
                           trs = "<tr style='background: white'><td>" + mac + "</td><td>" + '已注册' + "</td><td>" + pid + "</td><td>" + category_id + "</td><td>" + ip + "</td><td>" + unregdate + "</td><td>" + computername + "</td><td>" + device_class + "</td><td><button class='btn red btn-outline' onclick='node_logoff(\""+mac+"\")'>注销</button></td><td><button class='btn green btn-outline' onclick='node_delete(this,\""+mac+"\")'>删除</button></td></tr>";
                        }
                        tbody+=trs;

                        $("#temptable_ip").append(tbody);
                         if(iptableLen > 1){
                                 $("#iptable").show();
                             }
                             else{
                              $("#iptable").hide();
                          }
                        }
                        else {
                           alert(data['msg']);
                      }
                    }
                });
        }
}

    function node_logon(mac,pid){
            alert('确定注册此设备吗？');
            var unregdate = '2020-9-30';
             $.ajax({
                url:{% url "node_msg" %},
                type:'POST',
                dataType:'json',
                data:{'mac':mac,'unregdate':unregdate,'pid':pid},
                 success:function(data) {
                    if (data['status']==1) {
                        alert('注册成功！');
                        $.ajax({
                                url:{% url "node_search" %},
                                type:'POST',
                                dataType:'json',
                                data:{'mac_add':mac,'mac_style':'mac_is'},
                                  success:function(data) {
                                      $("#temptable tr:gt(0)").remove();
                                      var tbody = "";
                                      if(data!=""){
                                        for(var i=0;i<data.length;i++){
                                            var trs="";
                                            var mac = data[i][0];
                                            var status = data[i][1];
                                            var pid = data[i][2];
                                            var category_id = data[i][3];
                                            var ip = data[i][4];
                                            var unregdate = data[i][5];
                                            var computername = data[i][6];
                                            var device_class = data[i][7];
                                            if (status == 'unreg'){
                                               trs = "<tr style='background: white'><td>" + mac + "</td><td>" + '未注册' + "</td><td>" + pid + "</td><td>" + category_id + "</td><td>" + ip + "</td><td>" + unregdate + "</td><td>" + computername + "</td><td>" + device_class + "</td><td><button class='btn green btn-outline' onclick='node_logon(\""+mac+"\",\""+pid+"\")'>注册</button></td><td><button class='btn green btn-outline' onclick='node_delete(this,\""+mac+"\")'>删除</button></td></tr>";
                                            }
                                            else if (status == 'reg'){
                                               trs = "<tr style='background: white'><td>" + mac + "</td><td>" + '已注册' + "</td><td>" + pid + "</td><td>" + category_id + "</td><td>" + ip + "</td><td>" + unregdate + "</td><td>" + computername + "</td><td>" + device_class + "</td><td><button class='btn red btn-outline' onclick='node_logoff(this,\""+mac+"\")'>注销</button></td><td><button class='btn green btn-outline' onclick='node_delete(this,\""+mac+"\")'>删除</button></td></tr>";
                                            }
                                            tbody+=trs;
                                        }
                                        $("#temptable").append(tbody);
                                          if(adtableLen > 1){
                                                 $("#adtable").show();
                                             }
                                             else{
                                              $("#adtable").hide();
                                          }
                                             if(mactableLen > 1){
                                                 $("#mactable").show();
                                             }
                                             else{
                                                  $("#mactable").hide();
                                             }
                                        }
                                        else {
                                            alert('查无此MAC地址！')
                                      }
                                    }
                                });
                    }
                    else{
                        alert('注册失败！')
                    }
                    }
                });
        }

    function node_logoff(e,mac){
        var tables = $(e).parents("table").find("tr:gt(0)")
        console.info(tables)
            alert('确定注销此设备吗？');
             $.ajax({
                url:{% url "node_msg_logoff" %},
                type:'POST',
                dataType:'json',
                data:{'mac':mac},
                 success:function(data) {
                    if (data['status']==1) {
                        alert('注销成功！');
                        $.ajax({
                                url:{% url "node_search" %},
                                type:'POST',
                                dataType:'json',
                                data:{'mac_add':mac,'mac_style':'mac_is'},
                                  success:function(data) {
                                      tables.remove();
                                      var tbody = "";
                                      if(data!=""){
                                        for(var i=0;i<data.length;i++){
                                            var trs="";
                                            var mac = data[i][0];
                                            var status = data[i][1];
                                            var pid = data[i][2];
                                            var category_id = data[i][3];
                                            var ip = data[i][4];
                                            var unregdate = data[i][5];
                                            var computername = data[i][6];
                                            var device_class = data[i][7];
                                            if (status == 'unreg'){
                                               trs = "<tr style='background: white'><td>" + mac + "</td><td>" + '未注册' + "</td><td>" + pid + "</td><td>" + category_id + "</td><td>" + ip + "</td><td>" + unregdate + "</td><td>" + computername + "</td><td>" + device_class + "</td><td><button class='btn green btn-outline' onclick='node_logon(\""+mac+"\",\""+pid+"\")'>注册</button></td><td><button class='btn green btn-outline' onclick='node_delete(this,\""+mac+"\")'>删除</button></td></tr>";
                                            }
                                            else if (status == 'reg'){
                                               trs = "<tr style='background: white'><td>" + mac + "</td><td>" + '已注册' + "</td><td>" + pid + "</td><td>" + category_id + "</td><td>" + ip + "</td><td>" + unregdate + "</td><td>" + computername + "</td><td>" + device_class + "</td><td><button class='btn red btn-outline' onclick='node_logoff(\""+mac+"\",\""+pid+"\")'>注销</button></td><td><button class='btn green btn-outline' onclick='node_delete(this,\""+mac+"\")'>删除</button></td></tr>";
                                            }
                                            tbody+=trs;
                                        }
                                        $("#temptable").append(tbody);
                                          if(adtableLen > 1){
                                                 $("#adtable").show();
                                             }
                                             else{
                                              $("#adtable").hide();
                                          }
                                             if(mactableLen > 1){
                                                 $("#mactable").show();
                                             }
                                             else{
                                                  $("#mactable").hide();
                                             }
                                        }
                                        else {
                                            alert('查无此MAC地址！')
                                      }
                                    }
                                });
                    }
                    else{
                        alert('注销失败！')
                    }
                    }
                });
    }


    function node_delete(e,mac){
        var tr =$(e).parents("tr");
        $.ajax({
                url:{% url "node_delete" %},
                type:'POST',
                dataType:'json',
                data:{'mac':mac},
                  success:function(data) {
                    if (data['status']==1){
                     alert('删除成功！');
                     tr.remove();
                     if(adtableLen > 1){
                             $("#adtable").show();
                         }
                         else{
                          $("#adtable").hide();
                      }
                         if(mactableLen >1){
                             $("#mactable").show();
                         }
                         else{
                              $("#mactable").hide();
                         }
                    }
                    else {
                        alert('删除失败！')
                    }
                  }
                });
    }

</script>


{% endblock %}